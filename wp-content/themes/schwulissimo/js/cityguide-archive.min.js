jQuery(document).ready(function(a){function b(b){a.post(ajaxurl,{action:"get_tax_bounces",data:b},function(b){bounce=a.parseJSON(b),a.each(d,function(a,b){b.setMap(null)}),a(bounce).each(function(a,b){try{d[b].setMap(map),k=[],k.push(d[b]);for(var a=0;a<k.length;a++)l.extend(k[a].getPosition());map.fitBounds(l)}catch(a){}})})}function c(a){var b=new google.maps.Geocoder;b.geocode({address:a,region:"de"},function(a,b){b==google.maps.GeocoderStatus.OK&&(map.setCenter(a[0].geometry.location),map.setZoom(12))})}var markers=a.parseJSON(post_info.needles),d={};pwhere=a("#cityguide-where").val(),pwhat=a("#cityguide-what-id").val(),"undefined"!=typeof pwhere&&c(pwhere),a("#cityguide-where").change(function(){c(a(this).val()),where=a(this).val()});var e=a.parseJSON(cityguide_addresses.unique);a("#cityguide-where").autocomplete({source:e,minLength:2,select:function(a,b){c(b.item.value),where=b.item.value},appendTo:"#cityguide-where-container"});var f=a.parseJSON(cityguide_addresses.cats);a("#cityguide-what").autocomplete({source:f,minLength:2,select:function(c,e){return a.each(d,function(a,b){this.setAnimation(null)}),isNaN(e.item.value)?b(e.item.value):(a.each(d,function(a,b){b.setMap(map)}),d[e.item.value].setAnimation(google.maps.Animation.BOUNCE),latlng=d[e.item.value].getPosition(),map.setCenter(latlng),map.setZoom(16)),a("#cityguide-what").val(e.item.label),a("#cityguide-what-id").val(e.item.value),this.value=e.item.label,!1},appendTo:"#cityguide-what-container",delay:0,autoFocus:!0}),map=new google.maps.Map(document.getElementById("cityguide-archive-map"),{center:{lat:51,lng:9},zoom:5});var g,h,i=new google.maps.InfoWindow,j={url:post_info.markerIcon};for(h=0;h<markers.length;h++)g=new google.maps.Marker({position:{lat:parseFloat(markers[h].lat),lng:parseFloat(markers[h].lng)},map:map,icon:j}),d[markers[h].post_id]=g,google.maps.event.addListener(g,"click",function(b,c){return function(){i.setContent('<img src="'+post_info.spinner+'">'),i.open(map,b),a.post(ajaxurl,{data:markers[c].post_id,action:"get_map_infobox"},function(a){i.setContent(a)})}}(g,h));a.each(d,function(a,b){b.setMap(null)});var k=[],l=new google.maps.LatLngBounds;a(resultMarkers).each(function(a,b){try{d[b.post_id].setMap(map),k.push(d[b.post_id])}catch(a){}}),console.log(k);for(var h=0;h<k.length;h++)l.extend(k[h].getPosition());map.fitBounds(l),map.panToBounds(l)});